<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø£ÙÙ„Ø§Ù… T</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #333;
        }

        header {
            background: linear-gradient(135deg, rgba(30, 136, 229, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            color: white;
            padding: 10px 20px; /* Ø±ÙØ¹ Ø§Ù„Ù†Ø§ÙØ°Ø© */
            text-align: center;
            font-size: 22px; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
            font-weight: 800;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            border: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­ÙˆØ§Ù */
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) translateX(5px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .video-player-wrapper {
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            margin-bottom: 30px;
            aspect-ratio: 16/9;
        }

        .video-player-wrapper video {
            width: 100%;
            height: 100%;
            display: block;
        }

        .video-info {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .video-title {
            font-size: 32px;
            font-weight: 800;
            color: #1e88e5;
            margin-bottom: 15px;
        }

        .video-meta {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            color: #666;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 12px;
            background: rgba(30, 136, 229, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(30, 136, 229, 0.1);
            transition: none; /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª */
        }
        .meta-item i {
            animation: none !important; /* Ù…Ù†Ø¹ Ø£ÙŠ Ø¯ÙˆØ±Ø§Ù† Ø£Ùˆ Ø­Ø±ÙƒØ© */
            transform: none !important;
        }
        .meta-item i {
            font-size: 16px;
            color: #555;
        }
        .meta-item.views i { color: #1e88e5; }
        .meta-item.likes i { color: #ff4757; }
        .meta-item .value {
            font-weight: 700;
            color: #222;
            font-size: 16px;
        }

        .video-category {
            display: inline-block;
            padding: 5px 15px;
            background: #e3f2fd;
            color: #1e88e5;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }

        .btn-like {
            background: linear-gradient(135deg, #ff6b9d 0%, #ff4757 100%);
            color: white;
        }
        
        .btn-like:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-download {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            position: relative;
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255,75,43,0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255,75,43,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,75,43,0); }
        }

        .timer-display {
            display: none;
            font-size: 12px;
            color: #ff4b2b;
            margin-top: 5px;
            text-align: center;
            font-weight: 700;
            width: 100%;
        }

        .btn-share {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
        }
        .overlay.show { display: block; }

        .share-modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px; width: 90%;
        }
        .share-modal.show { display: block; }

        .toast {
            position: fixed;
            bottom: 30px; left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333; color: white;
            padding: 15px 30px; border-radius: 50px;
            font-weight: 600; z-index: 2000;
            transition: all 0.4s; opacity: 0;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: #4caf50; }
        .toast.error { background: #f44336; }

        .loading { text-align: center; padding: 60px 20px; color: white; }
        .loading i { font-size: 48px; margin-bottom: 20px; animation: spin 2s linear infinite; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .ad-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
            flex-direction: column;
            gap: 20px;
        }
        .ad-overlay.show { display: flex; }

        .ad-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .ad-content h3 {
            color: #1e88e5;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .ad-content p {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .ad-timer-container {
            margin: 20px auto;
            padding: 15px 30px;
            background: #f8f9fa;
            border-radius: 50px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #eee;
        }
        .ad-timer {
            font-size: 28px;
            font-weight: 900;
            color: #ff4757;
            min-width: 40px;
        }
        .ad-timer-text {
            font-size: 16px;
            color: #666;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .video-title { font-size: 24px; }
            .action-buttons { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body oncontextmenu="return false;">

<header>
    <button class="back-btn" onclick="window.history.back()"><i class="fas fa-arrow-left"></i> Ø±Ø¬ÙˆØ¹</button>
    <div><i class="fas fa-film"></i> Ø£ÙÙ„Ø§Ù… <span style="color:#ffeb3b;">T</span></div>
</header>

<div class="container">
    <div id="videoContent" class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...</p>
    </div>
</div>

<div class="overlay" id="overlay" onclick="closeShareModal()"></div>

<div class="share-modal" id="shareModal">
    <h3>ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h3>
    <input type="text" id="shareLink" style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:5px;" readonly>
    <button class="btn btn-share" onclick="copyShareLink()" style="width:100%;">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
    <button class="btn" onclick="closeShareModal()" style="width:100%; margin-top:10px; background:#f5f5f5; color:#666;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div class="toast" id="toast"></div>

<script>
const JSONBIN_ID = "698a066c43b1c97be9720f77";
const JSONBIN_KEY = "$2a$10$mRvosdx/sF8SxjPQLSmW2ezcrLEIzWw6Jj3ZzSJ11XgIn6DLJ5wXS";
const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}`;

let allVideos = [];
let currentVideo = null;
let currentVideoIndex = -1;

/* ================== NUMBER FORMATTER ================== */
function formatNumber(num) {
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1).replace('.0', '') + ' Ù…Ù„ÙŠÙˆÙ†';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1).replace('.0', '') + ' Ø£Ù„Ù';
    }
    return num.toString();
}

async function loadVideos() {
    try {
        const res = await fetch(JSONBIN_URL, { headers: { "X-Access-Key": JSONBIN_KEY } });
        const data = await res.json();
        allVideos = data.record.videos || [];
        const urlParams = new URLSearchParams(window.location.search);
        const videoId = parseInt(urlParams.get('id')) || 0;
        if (videoId >= 0 && videoId < allVideos.length) {
            currentVideoIndex = videoId;
            currentVideo = allVideos[videoId];
            renderVideo();
        }
    } catch (err) { console.error(err); }
}

function renderVideo() {
    if (!currentVideo) return;
    const displayViews = (currentVideo.views || 0) * 10;
    const displayLikes = (currentVideo.likes || 0) * 10;
    const likedVideos = JSON.parse(localStorage.getItem('likedVideos') || '[]');
    const isLiked = likedVideos.includes(currentVideo.url);

    document.getElementById('videoContent').innerHTML = `
        <div class="video-player-wrapper" id="videoPlayerWrapper" style="position: relative;">
            <video id="mainVideo" controls controlsList="nodownload" onplay="recordView()" oncontextmenu="return false;">
                <source src="${currentVideo.url}" type="video/mp4">
            </video>
            <div class="ad-overlay" id="adOverlay">
                <div class="ad-content">
                    <h3>ğŸ¬ Ø¥Ø¹Ù„Ø§Ù†</h3>
                    <p>Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù</p>
                    <div class="ad-timer-container">
                        <span class="ad-timer-text">Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø®Ù„Ø§Ù„:</span>
                        <div class="ad-timer" id="adTimer">5</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="video-info">
            <div class="video-category">${currentVideo.category || 'Ø¹Ø§Ù…'}</div>
            <h1 class="video-title">${currentVideo.title}</h1>
            <div class="video-meta">
                <div class="meta-item views"><i class="fas fa-eye"></i> <span class="value">${formatNumber(displayViews)}</span></div>
                <div class="meta-item likes"><i class="fas fa-heart"></i> <span class="value">${formatNumber(displayLikes)}</span></div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-like" id="likeBtn" onclick="toggleLike()" ${isLiked ? 'disabled' : ''}>
                    ${isLiked ? 'â¤ï¸ ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨' : 'â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨'}
                </button>
                <div style="flex:1; min-width:200px;">
                    <button class="btn btn-download" id="dlBtn" onclick="startProfitDownload()">
                        <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                    </button>
                    <div class="timer-display" id="timer">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 20 Ø«Ø§Ù†ÙŠØ© Ù„ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø§Ø¨Ø·...</div>
                </div>
                <button class="btn btn-share" onclick="openShareModal()">
                    <i class="fas fa-share-alt"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        initVideoWithAd();
    }, 100);
}

function recordView() {
    if (currentVideo && !currentVideo.viewRecorded) {
        currentVideo.views = (currentVideo.views || 0) + 1;
        currentVideo.viewRecorded = true;
        saveToCloud();
    }
}

function toggleLike() {
    const likedVideos = JSON.parse(localStorage.getItem('likedVideos') || '[]');
    if (likedVideos.includes(currentVideo.url)) return;
    currentVideo.likes = (currentVideo.likes || 0) + 1;
    likedVideos.push(currentVideo.url);
    localStorage.setItem('likedVideos', JSON.stringify(likedVideos));
    saveToCloud();
    document.getElementById('likeBtn').innerHTML = `â¤ï¸ ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨`;
    document.getElementById('likeBtn').disabled = true;
    showToast("Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ùƒ! âœ…", "success");
    setTimeout(() => { location.reload(); }, 1000);
}

function triggerIntenseAds() {
    for(let i=0; i<3; i++) {
        setTimeout(() => {
            window.open('https://pl28557264.effectivegatecpm.com/66/c7/7d/66c77d7ac95f5328a050e5b7c4929460.js', '_blank');
        }, i * 500);
    }
}

function startProfitDownload() {
    const btn = document.getElementById('dlBtn');
    const timer = document.getElementById('timer');
    let timeLeft = 20;
    btn.disabled = true;
    timer.style.display = 'block';
    triggerIntenseAds();
    const countdown = setInterval(() => {
        timeLeft--;
        btn.innerHTML = `Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²... ${timeLeft}`;
        if (timeLeft % 5 === 0) triggerIntenseAds();
        if (timeLeft <= 0) {
            clearInterval(countdown);
            btn.disabled = false;
            btn.innerHTML = `âœ… Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ`;
            btn.onclick = () => {
                triggerIntenseAds();
                window.open(currentVideo.url, '_blank');
                showToast("Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„..", "success");
            };
        }
    }, 1000);
}

async function saveToCloud() {
    await fetch(JSONBIN_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json", "X-Access-Key": JSONBIN_KEY },
        body: JSON.stringify({ videos: allVideos })
    });
}

function openShareModal() {
    document.getElementById('shareLink').value = window.location.href;
    document.getElementById('overlay').classList.add('show');
    document.getElementById('shareModal').classList.add('show');
}

function closeShareModal() {
    document.getElementById('overlay').classList.remove('show');
    document.getElementById('shareModal').classList.remove('show');
}

function copyShareLink() {
    const link = document.getElementById('shareLink');
    link.select();
    document.execCommand('copy');
    showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…", "success");
}

function showToast(m, t) {
    const toast = document.getElementById("toast");
    toast.textContent = m; toast.className = `toast ${t} show`;
    setTimeout(() => toast.className = "toast", 3000);
}

/* ================== AD SYSTEM ================== */
	function showAdBeforeVideo() {
	    const adOverlay = document.getElementById('adOverlay');
	    const adTimer = document.getElementById('adTimer');
	    const video = document.getElementById('mainVideo');
	    
	    if (!adOverlay) return;
	    adOverlay.classList.add('show');
	    if (video) video.pause();
	    
	    let timeLeft = 5;
	    adTimer.textContent = timeLeft;
	    
	    const countdown = setInterval(() => {
	        timeLeft--;
	        adTimer.textContent = timeLeft;
	        
	        if (timeLeft <= 0) {
	            clearInterval(countdown);
	            skipAd(); // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
	        }
	    }, 1000);
	}

function skipAd() {
    const adOverlay = document.getElementById('adOverlay');
    const video = document.getElementById('mainVideo');
    
    adOverlay.classList.remove('show');
    
    if (video) {
        video.play();
    }
}

function initVideoWithAd() {
    const video = document.getElementById('mainVideo');
    if (video) {
        video.addEventListener('play', function() {
            if (!this.hasShownAd) {
                this.pause();
                showAdBeforeVideo();
                this.hasShownAd = true;
            }
        }, { once: true });
    }
}

document.addEventListener("DOMContentLoaded", loadVideos);
</script>
</body>
</html>
